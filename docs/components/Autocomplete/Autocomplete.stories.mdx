import { Canvas, Meta } from "@storybook/addon-docs";
import { useState } from "react";
import cloneDeep from "lodash/cloneDeep";
import { Button } from "@jobber/components/Button";
import { Autocomplete } from "@jobber/components/Autocomplete";

<Meta
  title="Components/Forms and Inputs/Autocomplete/Docs"
  component={Autocomplete}
/>

# Autocomplete

An autocomplete allows a user to quickly pick a preset value from a larger list
of possible options.

If the number of available options is smaller consider a
[Select](../?path=/docs/components-selections-select--select) instead.

---

## With details

You can add a description to an option, which will appear below the option's
label. You can also add detail to an option that shows on the option's the
bottom right. Both of these are optional per option.

## Section headings

An autocomplete can provide section headings to break up the options.

## Kitchen sink

This autocomplete uses section headings, details, descriptions and option
separators.

## Setting a value

You can supply a value to `Autocomplete` in the form of an active `Option`.

<Canvas>
  {() => {
    const options = [
      { value: 1, label: "Nostromo" },
      { value: 2, label: "Rodger Young" },
      { value: 3, label: "Serenity" },
      { value: 4, label: "Sleeper Service" },
      { value: 5, label: "Enterprise" },
      { value: 6, label: "Enterprise-D" },
    ];
    const [value, setValue] = useState();
    return (
      <>
        <pre>{JSON.stringify(value, undefined, 2)}</pre>
        <Autocomplete
          value={value}
          initialOptions={[]}
          onChange={setValue}
          getOptions={getOptions}
          placeholder="Search for something"
        />
        <Button
          label="Choose the Enterprise"
          onClick={() => {
            setValue(options[4]);
          }}
        />
        <Button
          label="Reset"
          onClick={() => {
            setValue();
          }}
        />
      </>
    );
    function getOptions(text) {
      if (text === "") {
        return options;
      }
      const filterRegex = new RegExp(text, "i");
      return options.filter(option => option.label.match(filterRegex));
    }
  }}
</Canvas>

## Async requests for options

The `getOptions` method expected to be async so you can do any desired requests
using either promises or `await` in `getOptions`.

<Canvas>
  {() => {
    const options = [
      { value: 1, label: "Nostromo" },
      { value: 2, label: "Rodger Young" },
      { value: 3, label: "Serenity" },
      { value: 4, label: "Sleeper Service" },
      { value: 5, label: "Enterprise" },
      { value: 6, label: "Enterprise-D" },
    ];
    const [value, setValue] = useState();
    return (
      <Autocomplete
        value={value}
        initialOptions={[]}
        onChange={setValue}
        getOptions={getOptions}
        placeholder="Search for something"
      />
    );
    async function getOptions(text) {
      return new Promise(resolve => {
        setTimeout(() => {
          if (text === "") {
            resolve(options);
          }
          const filterRegex = new RegExp(text, "i");
          resolve(options.filter(option => option.label.match(filterRegex)));
        }, 300);
      });
    }
  }}
</Canvas>

## Related components

- If you want to present a list of predefined options without text input, use a
  [Select](../?path=/docs/components-selections-select--select) instead.
- If autocompleted results are not required for the text input, use
  [InputText](../?path=/docs/components-forms-and-inputs-inputtext--input-text)
  instead.
