import { Meta } from "@storybook/addon-docs";

# Input File

<Meta title="Components/Forms and Inputs/InputFile" />

InputFile allows users to upload a file, or multiple files by dragging and
dropping them into an area on the page or by clicking a button.

## Design & usage guidelines

When contributing to, or consuming the InputFile component, consider the
following:

- Provide feedback once the file(s) have been dropped and uploading begins.

## Filename Transformation

By default, InputFile preserves the original filename. If you need to transform
filenames for security, compatibility, or other reasons, you can provide an
external transformation function.

The `transformFilename` prop accepts any function that takes a filename string
and returns a transformed filename string. This can be used for:

- **Sanitizing filenames** (removing dangerous characters)
- **Normalizing filenames** (converting to lowercase, replacing spaces)
- **Adding prefixes/suffixes** (e.g., adding timestamps or UUIDs)
- **Any other filename transformation logic**

### Using sanitize-filename (Recommended for sanitization)

For most sanitization use cases, we recommend the well-tested
`sanitize-filename` npm package:

```bash
npm install sanitize-filename
```

```tsx
import sanitize from "sanitize-filename";

<InputFile transformFilename={sanitize} getUploadParams={getUploadParams} />;
```

### Using filenamify

Alternatively, you can use `filenamify`:

```bash
npm install filenamify
```

```tsx
import filenamify from "filenamify";

<InputFile transformFilename={filenamify} getUploadParams={getUploadParams} />;
```

### Custom Transformations

You can provide your own transformation logic for various use cases:

#### Normalizing filenames

```tsx
const normalizeFilename = (filename: string) => {
  return filename
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9.-]/g, "");
};

<InputFile
  transformFilename={normalizeFilename}
  getUploadParams={getUploadParams}
/>;
```

#### Adding timestamps

```tsx
const addTimestamp = (filename: string) => {
  const timestamp = Date.now();
  const [base, ext] = filename.split(".");
  return ext ? `${base}_${timestamp}.${ext}` : `${base}_${timestamp}`;
};

<InputFile
  transformFilename={addTimestamp}
  getUploadParams={getUploadParams}
/>;
```

#### Adding UUIDs

```tsx
import { v4 as uuidv4 } from "uuid";

const addUUID = (filename: string) => {
  const [base, ext] = filename.split(".");
  const uuid = uuidv4().slice(0, 8);
  return ext ? `${base}_${uuid}.${ext}` : `${base}_${uuid}`;
};

<InputFile transformFilename={addUUID} getUploadParams={getUploadParams} />;
```

### No Transformation (Default)

If you don't provide a `transformFilename` prop, the original filename is
preserved:

```tsx
<InputFile getUploadParams={getUploadParams} />
```

### Error Handling

The component includes built-in error handling for transformation functions:

- If the transformation function throws an error, it falls back to the original
  filename and reports the error via the `onUploadError` callback
- If the transformation function returns an empty string, it falls back to the
  original filename
- If the original filename is empty, it generates a default filename with
  timestamp

```tsx
<InputFile
  transformFilename={riskyTransform}
  onUploadError={error => {
    console.error("Upload error:", error.message);
    // Handle the error appropriately
  }}
  getUploadParams={getUploadParams}
/>
```
